<!DOCTYPE html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Community Compass</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
    crossorigin="anonymous"
  />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<html lang="en">
  <body>
    <header>
      <div class="header-container">
        <div class="header-column">
          <img
            src="img/CC Embelm.png"
            onclick="window.location.href='index.html'"
          />
        </div>
        <div
          class="header-column"
          onclick="window.location.href='Shelter.html'"
        >
          Shelters
        </div>
        <div
          class="header-column"
          onclick="window.location.href='FoodBank.html'"
        >
          Food Banks
        </div>
        <div
          class="header-column"
          onclick="window.location.href='Employment.html'"
        >
          Employment
        </div>
        <div
          class="header-column"
          onclick="window.location.href='eventsac.html'"
        >
          Events
        </div>
        <div
          class="header-column"
          onclick="window.location.href='Calendar.html'"
        >
          Calendar
        </div>
        <div class="header-column">
          <div class="row">
            <input
              type="text"
              id="input-box"
              placeholder="Search..."
              autocomplete="off"
              style="
                height: 40px;
                width: 20vw;
                padding: 0 10px;
                font-size: 16px;
                border: none;
              "
            />
          </div>
          <div
            class="result-box"
            style="
              z-index: 1050;
              max-height: 200px;
              overflow-y: auto;
              background-color: #fff;
              padding: 10px;
            "
          >
            <style>
              .result-box ul {
                border-top: 1px solid #ffff;
                padding: 10px;
                margin: 0;
                list-style-type: none;
              }
            </style>
          </div>
        </div>
      </div>
    </header>
    <div id="banner">
      <h2>Food Bank</h2>
      <h4>Nourishing Neighbors, Strengthening Communities</h4>
    </div>

    <div class="container" style="margin: 5vh 3vw">
      <div class="row">
        <div class="col-md-3">
          <div class="filters-container">
            <div class="filters-header">
              <h3>Filter By:</h3>
              <button class="search-button" id="search-button">Search</button>
            </div>
            <div id="Operating-Hours-Filters">
              <h3>Sort By</h3>
              <ul role="toolbar" style="list-style-type: none">
                <li>
                  <label class="custom-checkbox">
                    <input type="checkbox" checked />
                    <span></span> Relevancy
                  </label>
                </li>
                <li>
                  <label class="custom-checkbox">
                    <input type="checkbox" />
                    <span></span> Closest
                  </label>
                </li>
              </ul>
            </div>
            <div id="Operating-Hours-Filters">
              <h3>Operating Hours</h3>
              <ul role="toolbar" style="list-style-type: none">
                <li>
                  <label class="custom-checkbox">
                    <input type="checkbox" checked />
                    <span></span> Open Now
                  </label>
                </li>
                <li>
                  <label class="custom-checkbox">
                    <input type="checkbox" />
                    <span></span> 24 / 7
                  </label>
                </li>
                <li>
                  <label class="custom-checkbox">
                    <input type="checkbox" />
                    <span></span> Open Weekends
                  </label>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-9" style="padding: 4vw">
          <div class="container">
            <div class="card">
              <div class="row">
                <div class="col-md-12">
                  <h4 class="card-title m-2" id="food-list"></h4>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer style="background-color: #292929">
      <div
        class="footer-container"
        style="display: flex; justify-content: space-between"
      >
        <div
          class="footer-column"
          style="
            flex: 0; /* Each column takes equal space */
            margin-left: 10vw; /* Add some padding around the columns */
            display: flex;
            align-items: center;
            cursor: pointer;
          "
          onclick="window.location.href='index.html'"
        >
          <img
            class="CcEmbelm"
            style="width: 75px; height: 77.66px; flex: 1"
            src="img/SCCLogo.PNG"
          />
        </div>
        <div
          class="footer-column"
          style="
            text-align: center;
            color: white;
            font-size: 32px;
            font-family: 'Koh Santepheap';
            font-weight: 700;
            word-wrap: break-word;
            flex: 0.2; /* Each column takes equal space */
            display: flex;
            align-items: center;
            cursor: pointer;
          "
          onclick="window.location.href='index.html'"
        >
          Community <br />
          Compass
        </div>

        <div
          class="footer-column"
          style="
            flex: 1; /* Each column takes equal space */
            display: flex; /* Enables flexbox */
            flex-direction: column; /* Stacks children vertically */
            align-items: center; /* Centers items horizontally in the container */
            text-align: center; /* Aligns text centrally */
          "
        >
          <div
            class="Resources"
            style="
              color: white;
              font-size: 32px;
              font-family: 'Koh Santepheap';
              font-weight: 400;
              word-wrap: break-word;
              margin-bottom: 20px; /* Adds space between the title and the icons */
            "
          >
            Resources
          </div>
          <div
            style="
              display: flex; /* Enables flexbox for icons */
              flex-direction: row; /* Aligns icons in a row */
              justify-content: center; /* Centers icons horizontally */
              align-items: center; /* Centers icons vertically */
              flex-wrap: wrap; /* Allows icons to wrap on smaller screens */
            "
          >
            <div
              class="FoodBank"
              onclick="window.location.href = 'FoodBank.html'"
              style="
                color: white;
                font-size: 20px;
                font-family: 'Koh Santepheap';
                font-weight: 300;
                word-wrap: break-word;
                cursor: pointer;
                margin: 0 10px; /* Adds space between icons */
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                id="utensils"
                width="50"
                height="50"
              >
                <path
                  fill="#F3F3F3"
                  d="M19,2a1,1,0,0,0-1,1V8.46l-1,.67V3a1,1,0,0,0-2,0V9.13l-1-.67V3a1,1,0,0,0-2,0V9a1,1,0,0,0,.45.83L15,11.54V21a1,1,0,0,0,2,0V11.54l2.55-1.71A1,1,0,0,0,20,9V3A1,1,0,0,0,19,2ZM9,2H9A5,5,0,0,0,4,7v6a1,1,0,0,0,1,1H8v7a1,1,0,0,0,2,0V3A1,1,0,0,0,9,2ZM8,12H6V7A3,3,0,0,1,8,4.17Z"
                ></path>
              </svg>
            </div>
            <div
              class="Shelter"
              onclick="window.location.href = 'Shelter.html'"
              style="
                color: white;
                font-size: 20px;
                font-family: 'Koh Santepheap';
                font-weight: 300;
                word-wrap: break-word;
                cursor: pointer;
                margin: 0 10px; /* Adds space between icons */
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                id="home"
                width="50"
                height="50"
              >
                <path
                  fill="#F3F3F3"
                  d="M21.66,10.25l-9-8a1,1,0,0,0-1.32,0l-9,8a1,1,0,0,0-.27,1.11A1,1,0,0,0,3,12H4v9a1,1,0,0,0,1,1H19a1,1,0,0,0,1-1V12h1a1,1,0,0,0,.93-.64A1,1,0,0,0,21.66,10.25ZM13,20H11V17a1,1,0,0,1,2,0Zm5,0H15V17a3,3,0,0,0-6,0v3H6V12H18ZM5.63,10,12,4.34,18.37,10Z"
                ></path>
              </svg>
            </div>
            <div
              class="Employment"
              onclick="window.location.href = 'Employment.html'"
              style="
                color: white;
                font-size: 20px;
                font-family: 'Koh Santepheap';
                font-weight: 300;
                word-wrap: break-word;
                cursor: pointer;
                margin: 0 10px; /* Adds space between icons */
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                data-name="Layer 1"
                viewBox="0 0 24 24"
                id="constructor"
                width="50"
                height="50"
              >
                <path
                  fill="#F3F3F3"
                  d="M20,9.67V9.5a7.95,7.95,0,0,0-5.59-7.62l-.06,0a8.32,8.32,0,0,0-2.59-.36A8.21,8.21,0,0,0,4,9.67a3,3,0,0,0,0,5.66,8,8,0,0,0,8,7.17h.23a8.13,8.13,0,0,0,7.68-7.16A3,3,0,0,0,20,9.67ZM12.18,20.5a6,6,0,0,1-6.09-5H17.86A6.09,6.09,0,0,1,12.18,20.5Zm6.82-7H5a1,1,0,0,1,0-2H7a1,1,0,0,0,0-2H6A6.4,6.4,0,0,1,9,4.35V7.5a1,1,0,0,0,2,0V3.59a7.34,7.34,0,0,1,.82-.09H12a6.64,6.64,0,0,1,1,.09V7.5a1,1,0,0,0,2,0V4.32a6.65,6.65,0,0,1,1.18.87A6,6,0,0,1,18,9.5H17a1,1,0,0,0,0,2h2a1,1,0,0,1,0,2Z"
                ></path>
              </svg>
            </div>
            <div
              class="HealthCare"
              onclick="window.location.href = 'eventsac.html'"
              style="
                color: white;
                font-size: 20px;
                font-family: 'Koh Santepheap';
                font-weight: 300;
                word-wrap: break-word;
                cursor: pointer;
                margin: 0 10px; /* Adds space between icons */
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                data-name="Layer 1"
                viewBox="0 0 24 24"
                id="medkit"
                width="50"
                height="50"
              >
                <path
                  fill="#F3F3F3"
                  d="M10,17h1v1a1,1,0,0,0,2,0V17h1a1,1,0,0,0,0-2H13V14a1,1,0,0,0-2,0v1H10a1,1,0,0,0,0,2ZM19,6H17V5a3,3,0,0,0-3-3H10A3,3,0,0,0,7,5V6H5A3,3,0,0,0,2,9V19a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V9A3,3,0,0,0,19,6ZM9,5a1,1,0,0,1,1-1h4a1,1,0,0,1,1,1V6H9ZM20,19a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V12H20Zm0-9H4V9A1,1,0,0,1,5,8H19a1,1,0,0,1,1,1Z"
                ></path>
              </svg>
            </div>
            <div
              class="Calendar"
              onclick="window.location.href = 'calendar.html'"
              style="
                color: white;
                font-size: 20px;
                font-family: 'Koh Santepheap';
                font-weight: 300;
                word-wrap: break-word;
                cursor: pointer;
                margin: 0 10px; /* Adds space between icons */
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                id="calender"
                width="50"
                height="50"
              >
                <path
                  fill="#F3F3F3"
                  d="M19,4H17V3a1,1,0,0,0-2,0V4H9V3A1,1,0,0,0,7,3V4H5A3,3,0,0,0,2,7V19a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V7A3,3,0,0,0,19,4Zm1,15a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V12H20Zm0-9H4V7A1,1,0,0,1,5,6H7V7A1,1,0,0,0,9,7V6h6V7a1,1,0,0,0,2,0V6h2a1,1,0,0,1,1,1Z"
                ></path>
              </svg>
            </div>
          </div>
        </div>
        <div
          class="footer-column"
          style="
            flex: 0.5;
            display: flex; /* Enables flexbox layout */
            flex-direction: column; /* Stacks children vertically */
            justify-content: center; /* Centers children vertically */
            align-items: center; /* Centers children horizontally */
            height: 100%; /* Takes full height of its container */
            margin-right: 10vw;
          "
        >
          <div
            class="ContactUs"
            onclick="window.location.href = 'contact.html'"
            style="
              text-align: center;
              color: white;
              font-size: 32px;
              font-family: 'Koh Santepheap';
              font-weight: 400;
              word-wrap: break-word;
              margin: 2vh 0;
              cursor: pointer;
            "
          >
            Contact Us
          </div>
          <div
            class="AboutUs"
            onclick="window.location.href = 'AboutUs.html'"
            style="
              text-align: center;
              color: white;
              font-size: 32px;
              font-family: 'Koh Santepheap';
              font-weight: 400;
              word-wrap: break-word;
              margin: 2vh 0;
              cursor: pointer;
            "
          >
            About Us
          </div>
        </div>
      </div>
    </footer>
    <div
      class="copyrightSection"
      style="background-color: #00573d; color: #fff; padding: 1vh 0"
    >
      <div class="col-md-12 text-center">
        <p style="text-decoration: underline">
          &copy; Copyright Team X @CSUS 2024
        </p>
      </div>
    </div>

    <!-- Back to top button -->
    <button
      type="button"
      class="btn btn-danger btn-floating btn-lg"
      id="btn-back-to-top"
      style="
        background-color: #00573d;
        position: fixed;
        bottom: 20px;
        right: 20px;
        border: 2px solid;
      "
    >
      Back to Top
    </button>
    <script src="js/script.js"></script>
    <script src="js/backToTop.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchButton = document.getElementById('search-button');
      
        //Update search page on click
        searchButton.addEventListener('click', function() {
          const filters = document.querySelectorAll('.custom-checkbox input');
          const filterStatus = [];
  
          filters.forEach(filter => {
              const label = filter.parentNode.textContent.trim(); // Get the text of the label
              const isChecked = filter.checked; // Check if the checkbox is checked
              filterStatus.push(`${label},${isChecked ? 1 : 0}`);
          });
          
          //Constructing the input request:
          let data = "food@"
  
          //Appending the opennow flag: 
          let open_now_index = filterStatus.findIndex(item => item.startsWith("Open Now"));
          if (filters[open_now_index].checked) {
            data += "opennow@";
          } else {
            data += "anytime@";
          }
          filterStatus.splice(open_now_index, 1);
          console.log(open_now_index);
  
          //Appending filter values:
          data += filterStatus.join("@");
  
          //Print Request, - test
          console.log(data);
  
          const url = 'http://localhost:8080';
  
          // Fetch shelter data from the server using POST
          fetch(url, {
            method: 'POST', // Specify the method to POST
            headers: {
              'Content-Type': 'text/plain' // Set the Content-Type to text/plain
            },
            body: data // Send the data as the body of the request
          })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text(); // Get the response as text
          })
          .then((text) => {
            if(text.length > 0) {
            const container = document.getElementById("shelter-list");
            // Split the text by line to process each entry
            const lines = text.trim().split('@');
            console.log(lines);
            const data = lines.map(line => {
              const parts = line.split('|'); // Assuming data is split by commas
              return {
                name: parts[0].trim(),
                location: parts[1].trim(),
                description: parts[2].trim(),
                phone: parts[3].trim(),
                openingTime: parts[4].trim(),
                closingTime: parts[5].trim(),
                distance: parts[6].trim()
              };
            });
  
            //Display
            if (data.length > 0) {
              data.forEach((shelter) => {
                const card = document.createElement("div");
                  card.className = "card";
  
                  const row = document.createElement("div");
                  row.className = "row";
  
                  const colMd8 = document.createElement("div");
                  colMd8.className = "col-md-8";
  
                  const h4 = document.createElement("h4");
                  h4.innerText = shelter.name;
                  h4.className = "card-title mt-2";
                  colMd8.appendChild(h4);
  
                  const p = document.createElement("p");
                  p.innerText =
                    "Description: " +
                    (shelter.description || "No description available.");
                  colMd8.appendChild(p);
  
                  row.appendChild(colMd8);
  
                  const colMd4 = document.createElement("div");
                  colMd4.className = "col-md-4";
  
                  const phoneInfo = document.createElement("p");
                  phoneInfo.innerText =
                    "Phone: " + (shelter.phone || "No phone number available.");
                  colMd4.appendChild(phoneInfo);
  
                  row.appendChild(colMd4);
  
                  card.appendChild(row);
                  container.appendChild(card);
                });
              } else {
                console.log("No shelters found");
              }
        }})
            .catch((error) => {
              console.error("Error fetching data:", error);
              // Optionally display an error message on the webpage
              const container = document.getElementById("shelter-list");
              container.innerHTML = `<div class="alert alert-danger">Failed to load data: ${error.message}</div>`;
            });     
        }); 
        });
      </script>
  </body>
</html>
